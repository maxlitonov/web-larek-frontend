# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ — папка с общими компонентами
- src/components/view/ — папка с компонентами отображения
- src/components/model/ — папка с компонентами моделей данных

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/components/base/ — папка с типами данных базового кода
- src/types/components/common/ — папка с типами данных общих компонентов
- src/types/components/view/ — папка с типами данных компонентов отображения
- src/types/components/model/ — папка с типами данных компонентов моделей данных
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме МѴР:

- Слой представления `view`, отвечает за отображение данных на странице.
- Слой данных `model`, отвечает за хранение и изменение данных.
- Презентер `presenter`, отвечает за связь представления и данных, в данном приложении весь код находится в `src/index.ts`.

## Основные типы данных

### IAppState
Интерфейс модели данных приложения:
- `items: IProduct[]` - Массив продуктов на странице.
- `basket: string[]` - Массив продуктов в корзине.
- `basketTotal: number` - Кол-во продуктов в корзине.
- `order: IOrder` - Информация о заказе.
- `preview`: Состояние preview.
- `formErrors: FormErrors` - Ошибки валидации форм.

### IProduct
Интерфейс, описывающий продукт:
- `id: string` - Идентификатор продукта.
- `description: string` - Описание продукта.
- `image: string` - Ссылка на изображение.
- `title: string` - Название продукта.
- `category: string` - Категория продукта из константы `categories`.
- `price: number | null` - Цена продукта.

### ILarekApi
Интерфейс API:
- `getProducts: () => Promise<ProductApi[]>` - GET Запрос на получение карточек с сервера.
- `orderProducts: (order: IOrder) => Promise<IOrderResult>` - POST Запрос отправки заказа на сервер.

### IBasket
Интерфейс корзины:
- `products: HTMLElement[]` - Массив продуктов в корзине.
- `total: number` - Общая стоимость продуктов в корзине.
- `selected: string[]` - Отметка, что добавлен в корзину.

### IOrder
Интерфейс заказа:
- `payment: TOrderPaymentMethod` - Метод оплаты заказа.
- `address: string` - Адрес доставки заказа.
-	`email: string` - Почта заказчика.
-	`phone: string` - Номер телефона заказчика.
-	`total: number` - Общая сумма заказа.
-	`items: string[]` - Продукты в заказе.

`TOrder = Omit<IOrder, 'items' | 'total'>`

`TOrderForm = Pick<IOrder, 'payment' | 'address'>`

`TOrderContactsForm = Pick<IOrder, 'email' | 'phone'>`

`TOrderPaymentMethod = 'cash' | 'card'`

### IOrderResult
Интерфейс заказа для POST зароса на сервер:
- `id: string` - Массив id продуктов.
-	`total: number` - Общая стоимость продуктов.

### IPage
Интерфейс страницы:
- `productList: HTMLElement[]` -  Массив предметов на главной странице.
- `basketCounter: number` - Счетчик товаров в корзине на главной странице.
- `locked: boolean` - Блокировка страницы при модальном окне.

## Базовый код

### Класс Арі
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - Выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post`- Принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.


### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - Подписка на событие.
- `emit` - Инициализация события.
- `trigger` - Возвращает функцию, при вызове которой инициализируется требуемое в
  параметрах событие.

### Класс Component
Базовый класс, который наследуется всеми классами, отвечающим за отрисовку интерфейса на экране. Предоставляет методы классам-наследникам для управления разметкой.

В состав класса входят методы:
- `toggleClass` - Для переключения класса конкретного DOM-элемента.
- `setText` - Для установки текста в свойство textContent конкретного DOM-элемента.
- `setDisabled` - Для "отключения" переданного DOM-элемента.
- `setHidden` - Для скрытия конкретного DOM-элемента.
- `setVisible` - Для показа конкретного DOM-элемента.
- `setImage` - Для установки изображения (src) и альтернативного текста (alt) для конкретного DOM-элемента.
- `render` - Возвращает container с новыми переданными данными.
- `replaceChildren` Отрисовываются элементы разметки.


### Класс Model
Базовый класс, предназначенный для создания модельных данных, используемых для управления данными приложения. Напрямую "общается" с EventEmitter, принимая в конструктор данные модели и аргумент `events`.

Включает в себя только один метод:
- `emitChanges` - для сообщения всем подписчикам о том, что модель изменилась. 

## Общие `common` компоненты
### Класс Form наследуется от Component (`<IFormState>`)

#### Свойства:
- `protected _submit` - Кнопка submit.
- `protected _errors` - Ошибки валидации.

#### Методы класса:
- `protected onInputChange` - Оповещение об изменении в input определенного поля.
- `render` - Рендер формы.

#### Сеттеры
- `set valid` - Валидация, проходит или нет для блока кнопки.
- `set errors` - Задать ошибки.

### Класс Modal наследуется от Component (`<IModalData>`)

#### Свойства:
- `protected _closeButton` - Кнопка close.
- `protected _content` - Контейнер для контента.

#### Методы класса:
- `open` - Открыть modal.
- `close` - Закрыть modal.
- `render` - Рендер modal.

#### Сеттер
- `set content` - Установить контент.

## Компоненты модели данных (Model)
### Класс AppState
Класс для хранения актуального состояния приложения: данные о товаре, корзине, превью, заказе и ошибках. 
Наследуется от Model (`Model<IAppState>`).

#### Свойства:
- `items` - Массив всех продуктов.
- `basket` - Массив продуктов в корзине.
- `basketTotal`: Общая стоимость продуктов в корзине.
- `order` - Объект с данными заказа.
-	`preview` - Состояние preview.
-	`formErrors`- Ошибки валидации.

#### Методы класса:
- `setItems` - Инициализация массива с продуктами.
- `getItems` - Получение массива с продуктами.
- `setPreview` - Задать превью.
- `addToBasket` - Добавить в корзину.
- `removeFromBasket` - Удалить из корзины.
- `resetBasket` - Очистить корзину.
- `resetOrder` - Очистить данные о заказе.
- `setOrderField` - Установка данных о доставке заказа.
- `setContactField` - Установка данных о контактах.
- `validateOrderForm` - Валидация формы доставки.
- `validateContactsOrderForm` - Валидация формы контактов.

Этот класс управляет основными взаимодействиями и данными в приложении, обеспечивая централизованное управление состоянием.

## Класс larekApi
Класс для работы приложения с api.
Наследуется от `Api` и реализует интерфейс `ILarekApi`

#### Методы класса:
- `getProducts` - GET Запрос на получение карточек с сервера.
- `orderProducts` - POST Запрос на отправку заказа на сервер.

## Компоненты представления (View)
### Класс Basket
Корзина для покупок и оформление заказа, наследуется от Component (`Component<IBasket>`).

#### Свойства:
- `protected _list` - Массив карточек.
- `protected _total` - Кол-во карточек.
- `protected _button` - Кнопка.

#### Сеттеры:
- `set items` - Добавить карточку.
- `set selected` - Отметить в корзине, ли продукт (актив/деактив кнопки покупки).
- `set total` - Задать общую цену.

### Класс Card
Карточка товара, наследуется от Component (`Component<IProduct>`).

#### Свойства:
- `protected _description?` - Описание карточки.
- `protected _image?` - Ссылка на изображение карточки.
- `protected _title` - Название карточки.
- `protected _category?` - Категория карточки.
- `protected _price` - Цена карточки.
- `protected _button?` - Кнопка карточки.

#### Сеттеры и геттеры:
- `set id` - Установить идентификатор продукта в атрибут контейнера.
- `get id` - Вернуть идентификатор продукта из атрибута контейнера.
- `set description` - Установить описание.
- `get description` - Вернуть описание.
- `set image` - Установить путь к изображению.
- `set title` - Установить заголовок продукта.
- `get title` - Вернуть заголовок продукта.
- `set category` - Установить категорию продукта.
- `set price` - Установить текст цены продукта. Если цена отсутствует, указывает "Бесценно" и отключает кнопку.
- `set button` - Установить текст на кнопку.

### Класс OrderContactsForm
Форма заказа c контактами, наследуется от Form (`<TOrderContactsForm>`).

#### Свойства:
- `protected _email` - input email.
- `protected _phone` - input phone.

#### Сеттеры:
- `set email` - Задать email.
- `set phone` - Задать phone.

### Класс OrderPaymentForm
Форма заказа c доставкой, наследуется от Form (`<TOrderForm>`).

#### Свойства:
- `protected _address` - input address.
- `protected _paymentCash` - Копка наличной оплаты.
- `protected _paymentCard` - Копка онлайн оплаты.

#### Сеттеры:
- `set address` - Задать address.
- `set payment` - Задать способ оплаты.

### Класс OrderContactsForm
Форма заказа c контактами, наследуется от Form (`<TOrderContactsForm>`).

#### Свойства:
- `protected _email` - input email.
- `protected _phone` - input phone.

#### Сеттеры:
- `set email` - Задать email.
- `set phone` - Задать phone.

### Класс Page
Главная страница магазина, наследуется от Component (`<IPage>`).

#### Свойства:
- `protected _productContainer` - Контейнер с продуктами.
- `protected _basketCounterContainer` - Контейнер с счетчиком кол-ва товара в корзине.
- `protected _wrapperContainer` - Page wrapper.
- `protected _basketContainer` - Контейнер корзины.

#### Сеттеры:
- `set productList` - Установить предметы в контейнер.
- `set basketCounter` - Задать счетчик кол-ва товара в корзине.
- `set locked` - lock страницы при открытии modal окон.

### Класс Success
Главная страница магазина, наследуется от Component (`<ISuccess>`).

#### Свойства:
- `protected _total` - Контейнер с общей стоимостью отправленного заказа.
- `protected _close` - Контейнер с кнопкой close.

#### Сеттер:
- `set total` - Установить общую стоимость заказа.

## События в приложении

#### Основные события

- `card:changed` - запускает callback, который формирует карточки товаров. На каждую из карточек устанавливается обработчик события `card:select`.

- `card:select` - запускает callback, вызывающий метод `setPreview`, который, в свою очередь, запускает обработчик событие `preview:changed`.

- `preview:changed` - запускает callback, который в который передана карточка, создается новая карточка по клонированному template (cardPreviewTemplate), вешается слушатель на кнопку в зависимости от того есть ли уже товар в корзине и задается текст кнопки. Дальше происходит modal.render, в который передается card.render(item).